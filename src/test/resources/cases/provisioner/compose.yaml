services:
  wrenidm:
    extends:
      file: ../../base/common-services.yml
      service: wrenidm
    volumes:
      - ./conf/provisioner.openicf-ldap.json:/opt/wrenidm/conf/provisioner.openicf-ldap.json:ro
      - ./connectors:/opt/wrenidm/connectors:ro
    depends_on:
      ldap:
        condition: service_healthy

  ldap:
    image: osixia/openldap:1.5.0
    environment:
      LDAP_ORGANISATION: "Wren Security"
      LDAP_DOMAIN: "wrensecurity.org"
      LDAP_ADMIN_PASSWORD: "password"
    healthcheck:
      test: ["CMD", "ldapsearch", "-x", "-H", "ldap://localhost", "-b", "dc=wrensecurity,dc=org", "-D", "cn=admin,dc=wrensecurity,dc=org", "-w", "password"]
      interval: 5s
      timeout: 3s
      retries: 10
    networks:
      default:
        aliases:
          - ldap.wrensecurity.local
